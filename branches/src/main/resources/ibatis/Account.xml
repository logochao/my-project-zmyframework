<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="com.wendellup.app.valueobject.entity.Account">
	<typeAlias alias="Account"
		type="com.wendellup.app.valueobject.entity.Account" />

	<resultMap class="Account" id="accountResult">
		<result property="id" column="ID" />
		<result property="accountName" column="ACCOUNT_NAME" javaType="String"
			jdbcType="varchar" />
		<result property="accountPassword" column="ACCOUNT_PASSWORD" 
			javaType="String" jdbcType="varchar" />
		<result property="accountPicture" column="ACCOUNT_PICTURE" javaType="String"
			jdbcType="varchar" />
		<result property="accountCreateTime" column="ACCOUNT_CREATE_TIME" javaType="java.util.Date"
			jdbcType="datetime" />
	</resultMap>

	<select id="queryAll" resultMap="accountResult">
		select ID, ACCOUNT_NAME, ACCOUNT_PASSWORD, ACCOUNT_PICTURE, ACCOUNT_CREATE_TIME
		 from T_ACCOUNT;
	</select>

	<insert id="save" parameterClass="Account">
		insert into T_ACCOUNT (ACCOUNT_NAME,ACCOUNT_PASSWORD,ACCOUNT_PICTURE,ACCOUNT_CREATE_TIME)
		 values (#accountName#, #accountPassword#, #accountPicture#, now());
		<selectKey resultClass="int" keyProperty="id">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<select id="getById" parameterClass="Integer" resultMap="accountResult">
		select ID, ACCOUNT_NAME, ACCOUNT_PASSWORD, ACCOUNT_PICTURE, ACCOUNT_CREATE_TIME
		 from T_ACCOUNT where ID = #id#;
	</select>
	
	<delete id="delete" parameterClass="Integer">
		delete from T_ACCOUNT where ID = #id#;
	</delete>

	<update id="update">
		update T_ACCOUNT 
		 SET ACCOUNT_NAME = #accountName#, 
		 ACCOUNT_PASSWORD = #accountPassword#,
		 ACCOUNT_PICTURE = #accountPicture# 
		 where ID = #id#;
	</update>
	
	<!-- parameterClass="org.wendellup.core.support.QueryParams" -->
	<select id="queryByPage_count" resultClass="int" parameterClass="org.wendellup.core.support.QueryParams">
		select count(1) from T_ACCOUNT
        <dynamic prepend="WHERE">  
            <isNotEmpty prepend="AND" property="entity.name">  
                ACCOUNT_NAME like '%$entity.name$%'  
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="entity.startTime">  
            	<![CDATA[
                	ACCOUNT_CREATE_TIME > #entity.startTime#
                 ]]> 
            </isNotEmpty>  
            <isNotEmpty prepend="AND" property="entity.endTime">  
                <![CDATA[
                	ACCOUNT_CREATE_TIME < #entity.endTime#
                 ]]>  
            </isNotEmpty>
        </dynamic>  
	</select>
	
	<select id="queryByPage" resultMap="accountResult" parameterClass="org.wendellup.core.support.QueryParams">
		Select * from T_ACCOUNT t 
		<dynamic prepend="WHERE">  
            <isNotEmpty prepend="AND" property="entity.name">  
                ACCOUNT_NAME like '%$entity.name$%'  
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="entity.startTime">  
            	<![CDATA[
                	ACCOUNT_CREATE_TIME > #entity.startTime#
                 ]]> 
            </isNotEmpty>  
            <isNotEmpty prepend="AND" property="entity.endTime">  
                <![CDATA[
                	ACCOUNT_CREATE_TIME < #entity.endTime#
                 ]]>  
            </isNotEmpty>
        </dynamic> 
		<![CDATA[
		        limit  #paging.startRecord#,#paging.pageSize#
          ]]>
	</select>
	
	<select id="getNumByAccountName" resultClass="Integer">
		Select count(*) from T_ACCOUNT where ACCOUNT_NAME = #accountName# 
	</select>
	
	<select id="login" resultMap="accountResult" parameterClass="Account">
		select ID, ACCOUNT_NAME, ACCOUNT_PASSWORD, ACCOUNT_PICTURE, ACCOUNT_CREATE_TIME
		 from T_ACCOUNT 
		 where ACCOUNT_NAME = #accountName# and ACCOUNT_PASSWORD = #accountPassword#;
	</select>
</sqlMap>